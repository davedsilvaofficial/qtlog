#!/bin/bash

# Quantum Trek Master Index Generator
INDEX_FILE="MASTER_INDEX.md"
ET_TIME=$(TZ="America/New_York" date "+%Y-%m-%d %H:%M:%S ET")

echo "# ðŸš€ Quantum Trek Master Index" > $INDEX_FILE
echo "### Last Updated: $ET_TIME" >> $INDEX_FILE
echo "---" >> $INDEX_FILE
echo "This index serves as the official directory for the Quantum Trek Private Placement Memorandum (PPM) and Technical Data Room." >> $INDEX_FILE
echo "" >> $INDEX_FILE
echo "## ðŸ›¡ï¸ Security & Access" >> $INDEX_FILE
echo "* [Security Policy](./SECURITY.md) - IP Protection & Access Protocols" >> $INDEX_FILE
echo "" >> $INDEX_FILE

# Scan logic for categorized docs
DIRS=("01_Legal" "02_Finance" "03_Technical" "04_Defense")

for dir in "${DIRS[@]}"; do
    echo "## ${dir//_/ }" >> $INDEX_FILE
    if [ -d "docs/$dir" ] && [ "$(ls -A docs/$dir)" ]; then
        for file in docs/$dir/*; do
            filename=$(basename "$file")
            echo "* [$filename](./docs/$dir/$filename)" >> $INDEX_FILE
        done
    else
        echo "* *No documents uploaded yet.*" >> $INDEX_FILE
    fi
    echo "" >> $INDEX_FILE
done

echo "## ðŸ“„ General Documentation" >> $INDEX_FILE
# Lists files in the root of docs/ excluding the subdirectories
find docs/ -maxdepth 1 -type f | while read file; do
    filename=$(basename "$file")
    echo "* [$filename](./docs/$filename)" >> $INDEX_FILE
done

echo "" >> $INDEX_FILE
echo "---" >> $INDEX_FILE
echo "Generated by qtlog Unified CLI" >> $INDEX_FILE

chmod +x bin/generate_index.sh
echo "Master Index generated successfully."
