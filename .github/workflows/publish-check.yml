
name: Publish Guard

on:
  push:
    branches: [ "main" ]
  pull_request:

jobs:
  publish-guard:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Run publish guard (non-fatal)
        env:
          PUBLISH_ARGS: "--stamp-now --dry-run"
        id: publish_guard
        continue-on-error: true
        run: |
          set +e
          bash publish.sh $PUBLISH_ARGS
          rc=$?
          echo "rc=$rc"
          echo "publish_guard_exit_code=$rc" >>"$GITHUB_OUTPUT"
          exit 0
